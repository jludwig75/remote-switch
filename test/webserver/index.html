<html>
    <head>
        <title>Remote Switch</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script>
            const MSECS_PRE_SEC = 1000;
            function SECONDS(seconds) {
                return seconds * MSECS_PRE_SEC;
            }
            var enableRefresh = true;
            function refreshState() {
                $.get("/state", function(state) {
                    if (enableRefresh)
                    {
                        state = state.toUpperCase();
                        if (state == 'OFF')
                        {
                            $('#state').text('Switch Off');
                            $('#switch').text('On');
                        }
                        else
                        {
                            $('#state').text('Switch On');
                            $('#switch').text('Off');
                        }
                    }
                });
            }
            function handleButtonClick() {
                $('#switch').prop('disabled', true);
                enableRefresh = false
                var newState = 'ON';
                var message = 'Turning on..';
                var buttonText = $('#switch').text().toUpperCase();
                $('#switch').text('...');
                if (buttonText == 'OFF')
                {
                    newState = 'OFF';
                    message = 'Turning off..';
                }
                $('#state').text(message);
                $.post('/state', { state: newState }, function(data) {
                    $('#switch').prop('disabled', false);
                    enableRefresh = true;
                    refreshState();
                });
            }
            $(document).ready(function(){
                refreshState();
                $('#switch').click(handleButtonClick);
                //setInterval(refreshState, SECONDS(1));
            });
        </script>
        <style>
            .column_element {
                text-align: center;
                padding: 0.3em;
            }
        </style>
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <div id="main">
            <div class="column_element" id="state">
            </div>
            <div class="column_element" id="button">
                <button id="switch"></button>
            </div>
        </div>
    </body>
</html>